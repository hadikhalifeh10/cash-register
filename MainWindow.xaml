<Window x:Class="cashregister.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:vm="clr-namespace:cashregister.ViewModel"
        mc:Ignorable="d"
        Title="Cash Register" Height="900" Width="1400"
        Background="#0B0B0D" Foreground="#F3F3F3">
    <Window.DataContext>
        <vm:MainViewModel />
    </Window.DataContext>

    <Window.Resources>
        <!-- iOS dark mode palette: neutral dark surfaces with subtle separators -->
        <SolidColorBrush x:Key="Surface" Color="#0C0C0F"/>
        <SolidColorBrush x:Key="SecondarySurface" Color="#141418"/>
        <SolidColorBrush x:Key="TertiarySurface" Color="#1C1C20"/>
        <SolidColorBrush x:Key="Separator" Color="#2A2A2E"/>
        <SolidColorBrush x:Key="LabelPrimary" Color="#F2F2F7"/>
        <SolidColorBrush x:Key="LabelSecondary" Color="#C7C7CC"/>
        <SolidColorBrush x:Key="AccentBlue" Color="#0A84FF"/>
        <SolidColorBrush x:Key="AccentGreen" Color="#32D74B"/>
        <SolidColorBrush x:Key="AccentRed" Color="#FF453A"/>
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter" />

        <!-- Base control styles for dark mode -->
        <Style x:Key="DarkTextBox" TargetType="TextBox">
            <Setter Property="Background" Value="{StaticResource SecondarySurface}"/>
            <Setter Property="Foreground" Value="{StaticResource LabelPrimary}"/>
            <Setter Property="BorderBrush" Value="{StaticResource Separator}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="6,4"/>
        </Style>
        <Style x:Key="DarkButtonBase" TargetType="ButtonBase">
            <Setter Property="Background" Value="{StaticResource TertiarySurface}"/>
            <Setter Property="Foreground" Value="{StaticResource LabelPrimary}"/>
            <Setter Property="BorderBrush" Value="{StaticResource Separator}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="8,6"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ButtonBase">
                        <Border x:Name="Bd" CornerRadius="10" Background="{TemplateBinding Background}" BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="{TemplateBinding BorderThickness}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" />
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Bd" Property="Background" Value="{StaticResource SecondarySurface}" />
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="Opacity" Value="0.6" />
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        <Style TargetType="Button" BasedOn="{StaticResource DarkButtonBase}" />
        <Style TargetType="ToggleButton" BasedOn="{StaticResource DarkButtonBase}" />

        <!-- TabControl dark style -->
        <Style TargetType="TabControl">
            <Setter Property="Background" Value="{StaticResource Surface}"/>
            <Setter Property="Foreground" Value="{StaticResource LabelPrimary}"/>
        </Style>
        <Style TargetType="TabItem">
            <Setter Property="Foreground" Value="{StaticResource LabelPrimary}"/>
            <Setter Property="Background" Value="{StaticResource Surface}"/>
        </Style>

        <!-- ListView/GridView dark style -->
        <Style TargetType="ListView">
            <Setter Property="Background" Value="{StaticResource SecondarySurface}"/>
            <Setter Property="Foreground" Value="{StaticResource LabelPrimary}"/>
            <Setter Property="BorderBrush" Value="{StaticResource Separator}"/>
            <Setter Property="BorderThickness" Value="1"/>
        </Style>
        <Style TargetType="GridViewColumnHeader">
            <Setter Property="Foreground" Value="{StaticResource LabelSecondary}"/>
            <Setter Property="Background" Value="{StaticResource Surface}"/>
            <Setter Property="BorderBrush" Value="{StaticResource Separator}"/>
            <Setter Property="BorderThickness" Value="0,0,0,1"/>
            <Setter Property="Padding" Value="8,4"/>
        </Style>
    </Window.Resources>

    <DockPanel>
        <!-- Header -->
        <Border DockPanel.Dock="Top" Background="{StaticResource Surface}" Padding="14">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="2*"/>
                    <ColumnDefinition Width="2*"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                <TextBlock Text="Cash Register" FontSize="22" FontWeight="Bold" Foreground="{StaticResource LabelPrimary}"/>
                <TextBlock Grid.Column="1" Text="Zesty" FontSize="22" FontWeight="Bold" Foreground="HotPink" HorizontalAlignment="Center" VerticalAlignment="Center">
                    <TextBlock.Style>
                        <Style TargetType="TextBlock">
                            <Style.Triggers>
                                <EventTrigger RoutedEvent="Loaded">
                                    <BeginStoryboard>
                                        <Storyboard>
                                            <DoubleAnimation Storyboard.TargetProperty="Opacity" From="0" To="1" Duration="0:0:1" RepeatBehavior="Forever" AutoReverse="True"/>
                                            <DoubleAnimationUsingKeyFrames Storyboard.TargetProperty="(UIElement.RenderTransform).(TranslateTransform.X)">
                                                <LinearDoubleKeyFrame KeyTime="0%" Value="-20" />
                                                <LinearDoubleKeyFrame KeyTime="50%" Value="20" />
                                                <LinearDoubleKeyFrame KeyTime="100%" Value="-20" />
                                            </DoubleAnimationUsingKeyFrames>
                                        </Storyboard>
                                    </BeginStoryboard>
                                </EventTrigger>
                            </Style.Triggers>
                            <Setter Property="RenderTransform">
                                <Setter.Value>
                                    <TranslateTransform/>
                                </Setter.Value>
                            </Setter>
                        </Style>
                    </TextBlock.Style>
                </TextBlock>
                <StackPanel Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Center">
                    <TextBox Height="34" Width="420" Style="{StaticResource DarkTextBox}"/>
                    <TextBlock FontFamily="Segoe MDL2 Assets" Text="" Foreground="{StaticResource LabelSecondary}" FontSize="20" Margin="10,0,0,0" VerticalAlignment="Center"/>
                </StackPanel>
                <StackPanel Grid.Column="2" Orientation="Horizontal" HorizontalAlignment="Right" VerticalAlignment="Center">
                    <ToggleButton x:Name="OrdersToggle" Content="Orders" Margin="4,0" Width="80" Click="OrdersToggle_Click"/>
                    <Popup IsOpen="{Binding ElementName=OrdersToggle, Path=IsChecked}" PlacementTarget="{Binding ElementName=OrdersToggle}" Placement="Bottom" StaysOpen="False">
                        <Border Background="{StaticResource SecondarySurface}" BorderBrush="{StaticResource Separator}" BorderThickness="1" Padding="10" CornerRadius="10">
                            <StackPanel Orientation="Horizontal">
                                <TextBox Width="180" Height="32" Style="{StaticResource DarkTextBox}" Text="{Binding LoadReceiptNumber, UpdateSourceTrigger=PropertyChanged}" ToolTip="Enter receipt number" GotFocus="TextBox_GotFocus_SetNumeric" />
                                <Button Content="Load" Margin="10,0,0,0" Command="{Binding LoadReceiptCommand}" />
                            </StackPanel>
                        </Border>
                    </Popup>
                    <ToggleButton x:Name="AdminToggle" Content="Admin" Margin="6,0,0,0" Width="80" Click="AdminToggle_Click"/>
                    <Button Content="Close" Margin="6,0,0,0" Width="80" Command="{Binding CloseAppCommand}"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Main content -->
        <Grid Margin="12" DockPanel.Dock="Top">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="2*" />
                <ColumnDefinition Width="3*" />
            </Grid.ColumnDefinitions>

            <!-- Items Group -->
            <GroupBox Header="Items" Grid.Column="0" Margin="8" Padding="10" Background="{StaticResource Surface}" Foreground="{StaticResource LabelPrimary}">
                <DockPanel>
                    <TabControl ItemsSource="{Binding Categories}" SelectedItem="{Binding SelectedCategory}">
                        <TabControl.ItemTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding}" Foreground="{StaticResource LabelPrimary}" />
                            </DataTemplate>
                        </TabControl.ItemTemplate>
                        <TabControl.ContentTemplate>
                            <DataTemplate>
                                <ScrollViewer VerticalScrollBarVisibility="Auto">
                                    <ItemsControl ItemsSource="{Binding DataContext.Buttons, RelativeSource={RelativeSource AncestorType=TabControl}}" Margin="0,0,0,8" Padding="0,0,0,8" Background="{StaticResource Surface}">
                                        <ItemsControl.ItemsPanel>
                                            <ItemsPanelTemplate>
                                                <WrapPanel Orientation="Vertical" ItemWidth="150" ItemHeight="34" />
                                            </ItemsPanelTemplate>
                                        </ItemsControl.ItemsPanel>
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate>
                                                <Button Content="{Binding Label}" Command="{Binding Command}" Height="30" Width="140" Margin="4" />
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>
                                </ScrollViewer>
                            </DataTemplate>
                        </TabControl.ContentTemplate>
                    </TabControl>

                    <!-- Add new item row: textboxes on one row, Add button underneath -->
                    <StackPanel Orientation="Vertical" Margin="0,10,0,0" DockPanel.Dock="Bottom" Visibility="{Binding IsAdminMode, Converter={StaticResource BooleanToVisibilityConverter}}">
                        <StackPanel Orientation="Horizontal">
                            <TextBox Name="NewItemNameBox" Tag="NewItemName" Width="160" Height="28" Text="{Binding NewItemName, UpdateSourceTrigger=PropertyChanged}" GotFocus="TextBox_GotFocus_SetAlpha" />
                            <TextBox Name="NewItemPriceBox" Tag="NewItemPriceText" Width="100" Height="28" Margin="6,0,0,0" Text="{Binding NewItemPriceText, UpdateSourceTrigger=PropertyChanged}" GotFocus="TextBox_GotFocus_SetNumeric" />
                            <TextBox Name="NewItemCategoryBox" Tag="NewItemCategory" Width="120" Height="28" Margin="6,0,0,0" Text="{Binding NewItemCategory, UpdateSourceTrigger=PropertyChanged}" GotFocus="TextBox_GotFocus_SetAlpha" />
                        </StackPanel>
                        <Button Content="Add Item" Width="120" Height="30" Margin="0,6,0,0" HorizontalAlignment="Left" Command="{Binding AddNewItemCommand}" />
                    </StackPanel>
                </DockPanel>
            </GroupBox>

            <!-- Cart Group -->
            <GroupBox Header="Cart" Grid.Column="1" Margin="8" Padding="10" Background="{StaticResource Surface}" Foreground="{StaticResource LabelPrimary}">
                <DockPanel>
                    <ListView ItemsSource="{Binding Cart}" Name="CartList" DockPanel.Dock="Top">
                        <ListView.View>
                            <GridView>
                                <GridViewColumn Header="Name" DisplayMemberBinding="{Binding Name}" Width="180" />
                                <GridViewColumn Header="Price" DisplayMemberBinding="{Binding Price, StringFormat=C}" Width="100" />
                                <GridViewColumn Header="Qty" DisplayMemberBinding="{Binding Quantity}" Width="80" />
                                <GridViewColumn Header="Subtotal" DisplayMemberBinding="{Binding Subtotal, StringFormat=C}" Width="120" />
                                <GridViewColumn Header="Actions">
                                    <GridViewColumn.CellTemplate>
                                        <DataTemplate>
                                            <StackPanel Orientation="Horizontal">
                                                <Button Content="-" Width="24" Height="24" Margin="4"
                                                        Command="{Binding DataContext.RemoveFromCartCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                        CommandParameter="{Binding}"/>
                                                <Button Content="%" Width="24" Height="24" Margin="4"
                                                        ToolTip="Apply item discount"
                                                        Command="{Binding DataContext.ApplyItemDiscountCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                        CommandParameter="{Binding}"/>
                                            </StackPanel>
                                        </DataTemplate>
                                    </GridViewColumn.CellTemplate>
                                </GridViewColumn>
                            </GridView>
                        </ListView.View>
                    </ListView>

                    <StackPanel Orientation="Vertical" HorizontalAlignment="Right" Margin="0,10,0,0" DockPanel.Dock="Bottom">
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                            <TextBox Name="DiscountBox" Tag="DiscountText" Width="120" Height="28" Style="{StaticResource DarkTextBox}" Text="{Binding DiscountText, UpdateSourceTrigger=PropertyChanged}" ToolTip="Enter discount (e.g., 10 or 10%)" GotFocus="TextBox_GotFocus_SetNumeric" />
                            <Button Content="Discount Total" Margin="8,0,0,0" Command="{Binding ApplyTotalDiscountCommand}" />
                        </StackPanel>

                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                            <TextBlock Text="Subtotal:" VerticalAlignment="Center" Margin="0,0,5,0" Foreground="{StaticResource LabelSecondary}" />
                            <TextBlock Text="{Binding Subtotal, StringFormat=C}" VerticalAlignment="Center" Width="120" Foreground="{StaticResource LabelPrimary}" />
                        </StackPanel>
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                            <TextBlock Text="GST (5%):" VerticalAlignment="Center" Margin="0,0,5,0" Foreground="{StaticResource LabelSecondary}" />
                            <TextBlock Text="{Binding Gst, StringFormat=C}" VerticalAlignment="Center" Width="120" Foreground="{StaticResource LabelPrimary}" />
                        </StackPanel>
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                            <TextBlock Text="QST (9.975%):" VerticalAlignment="Center" Margin="0,0,5,0" Foreground="{StaticResource LabelSecondary}" />
                            <TextBlock Text="{Binding Qst, StringFormat=C}" VerticalAlignment="Center" Width="120" Foreground="{StaticResource LabelPrimary}" />
                        </StackPanel>
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                            <TextBlock Text="Total:" FontWeight="Bold" VerticalAlignment="Center" Margin="0,0,5,0" Foreground="{StaticResource LabelSecondary}" />
                            <TextBlock Text="{Binding Total, StringFormat=C}" VerticalAlignment="Center" Width="120" Foreground="{StaticResource LabelPrimary}" />
                            <ToggleButton x:Name="PayToggle" IsChecked="{Binding IsPayPopupOpen, Mode=TwoWay}" Content="Pay" Margin="10,0,0,0" Width="110" />
                            <Popup IsOpen="{Binding IsPayPopupOpen, Mode=TwoWay}" PlacementTarget="{Binding ElementName=PayToggle}" Placement="Bottom" StaysOpen="False">
                                <Border Padding="10" CornerRadius="10">
                                    <StackPanel>
                                        <TextBlock Text="Choose bill type" Margin="0,0,0,4"/>
                                        <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                            <Button Content="1 Bill" Width="90" Margin="0,0,8,0" Command="{Binding ChooseOneBillCommand}"/>
                                            <Button Content="Split Bill" Width="90" Command="{Binding StartSplitBillCommand}"/>
                                        </StackPanel>
                                        <StackPanel Visibility="{Binding ShowPaymentMethods, Converter={StaticResource BooleanToVisibilityConverter}}">
                                            <Button Content="Credit" Command="{Binding PayCreditCommand}" Width="130" Margin="0,6,0,6" />
                                            <Button Content="Debit" Command="{Binding PayDebitCommand}" Width="130" Margin="0,6,0,6" />
                                            <Button Content="Cash" Command="{Binding ShowCashTenderCommand}" Width="130" Margin="0,6,0,6" />
                                        </StackPanel>
                                    </StackPanel>
                                </Border>
                            </Popup>
                            <Button Content="Cancel" Margin="10,0,0,0" Width="110" Command="{Binding CancelCommand}" />
                        </StackPanel>

                        <!-- Split bill popup -->
                        <Popup IsOpen="{Binding IsSplitPopupOpen}" Placement="Bottom" StaysOpen="False">
                            <Border Background="{StaticResource SecondarySurface}" BorderBrush="{StaticResource Separator}" BorderThickness="1" Padding="12" CornerRadius="10">
                                <StackPanel MinWidth="520">
                                    <TextBlock Text="Split Bill" FontWeight="Bold" Margin="0,0,0,8"/>

                                    <!-- Person navigator -->
                                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center" Margin="0,0,0,8">
                                        <Button Content="◀" Width="36" Command="{Binding PrevSplitPersonCommand}"/>
                                        <TextBlock Text="{Binding SelectedSplitPerson.Name}" Width="160" HorizontalAlignment="Center" VerticalAlignment="Center" TextAlignment="Center" Margin="8,0"/>
                                        <Button Content="▶" Width="36" Command="{Binding NextSplitPersonCommand}"/>
                                        <Button Content="Add Person" Command="{Binding AddSplitPersonCommand}" Width="120" Margin="12,0,0,0"/>
                                        <Button Content="Remove" Command="{Binding RemoveSplitPersonCommand}" Width="120" Margin="8,0,0,0"/>
                                    </StackPanel>

                                    <!-- Selected person editor -->
                                    <ContentControl Content="{Binding SelectedSplitPerson}">
                                        <ContentControl.ContentTemplate>
                                            <DataTemplate>
                                                <StackPanel>
                                                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center" Margin="0,0,0,6">
                                                        <TextBox Width="160" Text="{Binding Name, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource DarkTextBox}"/>
                                                        <TextBlock Text=" Payment:" Margin="8,0,4,0"/>
                                                        <ComboBox Width="120" SelectedValue="{Binding PaymentMethod, Mode=TwoWay}">
                                                            <ComboBoxItem Content="Credit"/>
                                                            <ComboBoxItem Content="Debit"/>
                                                            <ComboBoxItem Content="Cash"/>
                                                        </ComboBox>
                                                    </StackPanel>

                                                    <TextBlock Text="Assign items:" Margin="0,0,0,4"/>
                                                    <ItemsControl ItemsSource="{Binding DataContext.SplitItems, RelativeSource={RelativeSource AncestorType=Popup}}">
                                                        <ItemsControl.ItemTemplate>
                                                            <DataTemplate>
                                                                <StackPanel Orientation="Horizontal" Margin="0,2,0,2">
                                                                    <TextBlock Text="{Binding Item.Name}" Margin="0,0,8,0" Width="160"/>
                                                                    <TextBlock Text="{Binding Item.Subtotal, StringFormat=C}" Margin="0,0,8,0" Width="80"/>
                                                                    <ComboBox Width="160"
                                                                              ItemsSource="{Binding DataContext.SplitPeople, RelativeSource={RelativeSource AncestorType=Popup}}"
                                                                              SelectedItem="{Binding AssignedTo, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                                              DisplayMemberPath="Name"/>
                                                                    <Button Content="Clear" Width="70" Margin="8,0,0,0" Command="{Binding DataContext.ClearSplitItemAssignmentCommand, RelativeSource={RelativeSource AncestorType=Popup}}" CommandParameter="{Binding}"/>
                                                                </StackPanel>
                                                            </DataTemplate>
                                                        </ItemsControl.ItemTemplate>
                                                    </ItemsControl>

                                                    <StackPanel Orientation="Horizontal" Margin="0,6,0,0">
                                                        <TextBlock Text="Subtotal:" Width="120"/>
                                                        <TextBlock Text="{Binding Subtotal, StringFormat=C}" Width="120"/>
                                                        <TextBlock Text="GST:" Width="80"/>
                                                        <TextBlock Text="{Binding Gst, StringFormat=C}" Width="120"/>
                                                        <TextBlock Text="QST:" Width="80"/>
                                                        <TextBlock Text="{Binding Qst, StringFormat=C}" Width="120"/>
                                                        <TextBlock Text="Total:" Width="80"/>
                                                        <TextBlock Text="{Binding Total, StringFormat=C}" Width="120"/>
                                                    </StackPanel>
                                                </StackPanel>
                                            </DataTemplate>
                                        </ContentControl.ContentTemplate>
                                    </ContentControl>

                                    <!-- Aggregate split summary -->
                                    <StackPanel Orientation="Horizontal" Margin="0,8,0,0">
                                        <TextBlock Text="Assigned Total:"/>
                                        <TextBlock Text="{Binding SplitAssignedTotal, StringFormat=C}" Margin="6,0,12,0"/>
                                        <TextBlock Text="Left to Pay:"/>
                                        <TextBlock Text="{Binding SplitLeftToPay, StringFormat=C}" Margin="6,0,12,0"/>
                                        <TextBlock Text="Change:"/>
                                        <TextBlock Text="{Binding SplitChange, StringFormat=C}" Margin="6,0,12,0"/>
                                    </StackPanel>

                                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,8,0,0">
                                        <Button Content="Confirm" Command="{Binding ConfirmSplitPaymentCommand}" Width="120"/>
                                        <Button Content="Cancel" Command="{Binding CancelSplitCommand}" Width="120" Margin="8,0,0,0"/>
                                    </StackPanel>
                                </StackPanel>
                            </Border>
                        </Popup>

                        <Popup IsOpen="{Binding IsCashTenderVisible}" Placement="Bottom" StaysOpen="False">
                            <Border Background="{StaticResource SecondarySurface}" BorderBrush="{StaticResource Separator}" BorderThickness="1" Padding="12" CornerRadius="10">
                                <StackPanel>
                                    <TextBlock Text="Cash received:" Margin="0,0,0,6" Foreground="{StaticResource LabelSecondary}" />
                                    <TextBox Name="CashTenderBox" Tag="CashTenderText" Width="180" Height="28" Style="{StaticResource DarkTextBox}" Text="{Binding CashTenderText, UpdateSourceTrigger=PropertyChanged}" GotFocus="TextBox_GotFocus_SetNumeric" />
                                    <TextBlock Text="{Binding CashDue, StringFormat=Due: {0:C}}" Margin="0,6,0,0" Foreground="{StaticResource LabelPrimary}"/>
                                    <TextBlock Text="{Binding CashChange, StringFormat=Change: {0:C}}" Foreground="{StaticResource LabelPrimary}"/>
                                    <Button Content="Confirm" Command="{Binding ConfirmCashPaymentCommand}" Width="130" Margin="0,8,0,0"/>
                                </StackPanel>
                            </Border>
                        </Popup>

                        <Border Background="{StaticResource SecondarySurface}" BorderBrush="{StaticResource Separator}" BorderThickness="1" Padding="8" Margin="0,8,0,0" CornerRadius="8">
                            <DockPanel>
                                <TextBlock Text="{Binding StatusMessage}" FontSize="12" Foreground="{StaticResource LabelSecondary}" VerticalAlignment="Center"/>
                                <Button Content="Reset App" DockPanel.Dock="Right" Width="80" FontSize="10" Background="#330000" Command="{Binding FactoryResetCommand}"/>
                            </DockPanel>
                        </Border>
                    </StackPanel>
                </DockPanel>
            </GroupBox>
        </Grid>

        <!-- On-screen keyboard docked bottom -->
        <Border DockPanel.Dock="Bottom" Background="{StaticResource Surface}" BorderBrush="{StaticResource Separator}" BorderThickness="1" Padding="16" CornerRadius="12">
            <StackPanel>
                <UniformGrid Rows="3" Columns="9" Visibility="{Binding IsAlphaKeyboardVisible, Converter={StaticResource BooleanToVisibilityConverter}}">
                    <Button Content="A" Width="52" Height="52" Margin="6" Command="{Binding InsertKeyboardCharCommand}" CommandParameter="A"/>
                    <Button Content="B" Width="52" Height="52" Margin="6" Command="{Binding InsertKeyboardCharCommand}" CommandParameter="B"/>
                    <Button Content="C" Width="52" Height="52" Margin="6" Command="{Binding InsertKeyboardCharCommand}" CommandParameter="C"/>
                    <Button Content="D" Width="52" Height="52" Margin="6" Command="{Binding InsertKeyboardCharCommand}" CommandParameter="D"/>
                    <Button Content="E" Width="52" Height="52" Margin="6" Command="{Binding InsertKeyboardCharCommand}" CommandParameter="E"/>
                    <Button Content="F" Width="52" Height="52" Margin="6" Command="{Binding InsertKeyboardCharCommand}" CommandParameter="F"/>
                    <Button Content="G" Width="52" Height="52" Margin="6" Command="{Binding InsertKeyboardCharCommand}" CommandParameter="G"/>
                    <Button Content="H" Width="52" Height="52" Margin="6" Command="{Binding InsertKeyboardCharCommand}" CommandParameter="H"/>
                    <Button Content="I" Width="52" Height="52" Margin="6" Command="{Binding InsertKeyboardCharCommand}" CommandParameter="I"/>
                    <Button Content="J" Width="52" Height="52" Margin="6" Command="{Binding InsertKeyboardCharCommand}" CommandParameter="J"/>
                    <Button Content="K" Width="52" Height="52" Margin="6" Command="{Binding InsertKeyboardCharCommand}" CommandParameter="K"/>
                    <Button Content="L" Width="52" Height="52" Margin="6" Command="{Binding InsertKeyboardCharCommand}" CommandParameter="L"/>
                    <Button Content="M" Width="52" Height="52" Margin="6" Command="{Binding InsertKeyboardCharCommand}" CommandParameter="M"/>
                    <Button Content="N" Width="52" Height="52" Margin="6" Command="{Binding InsertKeyboardCharCommand}" CommandParameter="N"/>
                    <Button Content="O" Width="52" Height="52" Margin="6" Command="{Binding InsertKeyboardCharCommand}" CommandParameter="O"/>
                    <Button Content="P" Width="52" Height="52" Margin="6" Command="{Binding InsertKeyboardCharCommand}" CommandParameter="P"/>
                    <Button Content="Q" Width="52" Height="52" Margin="6" Command="{Binding InsertKeyboardCharCommand}" CommandParameter="Q"/>
                    <Button Content="R" Width="52" Height="52" Margin="6" Command="{Binding InsertKeyboardCharCommand}" CommandParameter="R"/>
                    <Button Content="S" Width="52" Height="52" Margin="6" Command="{Binding InsertKeyboardCharCommand}" CommandParameter="S"/>
                    <Button Content="T" Width="52" Height="52" Margin="6" Command="{Binding InsertKeyboardCharCommand}" CommandParameter="T"/>
                    <Button Content="U" Width="52" Height="52" Margin="6" Command="{Binding InsertKeyboardCharCommand}" CommandParameter="U"/>
                    <Button Content="V" Width="52" Height="52" Margin="6" Command="{Binding InsertKeyboardCharCommand}" CommandParameter="V"/>
                    <Button Content="W" Width="52" Height="52" Margin="6" Command="{Binding InsertKeyboardCharCommand}" CommandParameter="W"/>
                    <Button Content="X" Width="52" Height="52" Margin="6" Command="{Binding InsertKeyboardCharCommand}" CommandParameter="X"/>
                    <Button Content="Y" Width="52" Height="52" Margin="6" Command="{Binding InsertKeyboardCharCommand}" CommandParameter="Y"/>
                    <Button Content="Z" Width="52" Height="52" Margin="6" Command="{Binding InsertKeyboardCharCommand}" CommandParameter="Z"/>
                    <Button Content="Space" Width="120" Height="52" Margin="6" Command="{Binding InsertKeyboardCharCommand}" CommandParameter=" "/>
                    <Button Content="Bksp" Width="90" Height="52" Margin="6" Command="{Binding KeyboardBackspaceCommand}"/>
                    <Button Content="Clear" Width="90" Height="52" Margin="6" Command="{Binding KeyboardClearCommand}"/>
                </UniformGrid>
                <UniformGrid Rows="4" Columns="4" Visibility="{Binding IsNumericKeyboardVisible, Converter={StaticResource BooleanToVisibilityConverter}}" Margin="0,10,0,0">
                    <Button Content="1" Width="56" Height="56" Margin="6" Command="{Binding InsertKeyboardCharCommand}" CommandParameter="1"/>
                    <Button Content="2" Width="56" Height="56" Margin="6" Command="{Binding InsertKeyboardCharCommand}" CommandParameter="2"/>
                    <Button Content="3" Width="56" Height="56" Margin="6" Command="{Binding InsertKeyboardCharCommand}" CommandParameter="3"/>
                    <Button Content="4" Width="56" Height="56" Margin="6" Command="{Binding InsertKeyboardCharCommand}" CommandParameter="4"/>
                    <Button Content="5" Width="56" Height="56" Margin="6" Command="{Binding InsertKeyboardCharCommand}" CommandParameter="5"/>
                    <Button Content="6" Width="56" Height="56" Margin="6" Command="{Binding InsertKeyboardCharCommand}" CommandParameter="6"/>
                    <Button Content="7" Width="56" Height="56" Margin="6" Command="{Binding InsertKeyboardCharCommand}" CommandParameter="7"/>
                    <Button Content="8" Width="56" Height="56" Margin="6" Command="{Binding InsertKeyboardCharCommand}" CommandParameter="8"/>
                    <Button Content="9" Width="56" Height="56" Margin="6" Command="{Binding InsertKeyboardCharCommand}" CommandParameter="9"/>
                    <Button Content="0" Width="56" Height="56" Margin="6" Command="{Binding InsertKeyboardCharCommand}" CommandParameter="0"/>
                    <Button Content="." Width="56" Height="56" Margin="6" Command="{Binding InsertKeyboardCharCommand}" CommandParameter="."/>
                    <Button Content="Bksp" Width="90" Height="56" Margin="6" Command="{Binding KeyboardBackspaceCommand}"/>
                    <Button Content="Clear" Width="90" Height="56" Margin="6" Command="{Binding KeyboardClearCommand}"/>
                </UniformGrid>
            </StackPanel>
        </Border>
    </DockPanel>
</Window>
